# 云端会话同步 - 常见问题解答

## 配置相关

### Q: 如何配置七牛云？

**A**: 请参考 [七牛云配置指南](./qiniu-setup-guide.md)。简要步骤:

1. 注册七牛云账号: https://www.qiniu.com/
2. 创建存储空间 (Bucket)
3. 获取 AccessKey 和 SecretKey
4. 运行 `/configure-qiniu` 配置

### Q: 必须使用七牛云吗？

**A**: 是的，当前版本仅支持七牛云。未来可能考虑支持其他云存储服务商。

### Q: 数据存储在哪里？

**A**: 数据存储在您配置的七牛云存储空间中，位于您选择的区域。

### Q: 如何更换七牛云账号？

**A**:

```bash
# 重新配置
/configure-qiniu

# 导出旧数据（如需要）
/list-sessions
/restore-session <id>
```

---

## 安全相关

### Q: 数据安全吗？

**A**: 是的，非常安全:

- **加密传输**: 所有数据通过 HTTPS 传输
- **加密存储**: 使用 AES-256-GCM 加密
- **密钥保护**: 密钥由您控制，不会上传到云端
- **私密空间**: 使用私有存储空间

即使七牛云被攻破，攻击者也无法读取您的会话数据。

### Q: 七牛云能看到我的会话内容吗？

**A**: 不能。所有数据在客户端加密后才上传，七牛云只能看到加密后的密文。

### Q: 如何选择加密模式？

**A**:

| 模式         | 优点         | 缺点             | 适用场景   |
| ------------ | ------------ | ---------------- | ---------- |
| **用户密码** | 完全自主控制 | 跨设备需输入密码 | 单设备使用 |
| **API Key**  | 跨设备方便   | 密钥需安全保管   | 多设备使用 |

**推荐**: 多设备用户使用 API Key 模式。

### Q: 忘记密码怎么办？

**A**: 如果使用密码模式加密，忘记密码将**无法恢复**云端会话。建议:

1. 使用 API Key 模式
2. 妥善导出密钥备份: `/export-key`

### Q: 密钥丢失怎么办？

**A**:

- 密钥丢失后，云端数据无法解密
- 建议定期导出密钥并安全保存
- 可以重新开始使用新的密钥

---

## 使用相关

### Q: 如何同步会话？

**A**:

```bash
# 同步当前会话
/sync-session

# 启用自动同步
/sync-session --auto
```

### Q: 如何在其他设备上恢复会话？

**A**:

```bash
# 1. 在新设备上配置相同的加密密钥
/import-key <base64-key>

# 2. 列出云端会话
/list-sessions

# 3. 恢复会话
/restore-session <session-id>
```

### Q: 同步后能看到完整对话历史吗？

**A**: 是的。同步后可以看到完整的:

- 对话历史
- 文件引用
- 工作上下文
- 任务状态

### Q: 可以同步多个项目的会话吗？

**A**: 可以。每个会话独立同步，可以在不同项目间自由切换。

### Q: 自动同步会消耗很多流量吗？

**A**: 不会:

- 增量同步，仅传输变更内容
- GZIP 压缩，减少 70%+ 数据量
- 可配置同步间隔

---

## 冲突相关

### Q: 什么是冲突？

**A**: 当多个设备同时修改同一会话时，会产生冲突。例如:

1. 在电脑 A 上修改会话
2. 在电脑 B 上也修改同一会话
3. 两个设备都尝试同步

### Q: 如何解决冲突？

**A**: 系统会提示您选择:

1. **保留本地版本**: 用本地覆盖云端
2. **保留云端版本**: 用云端覆盖本地
3. **手动合并**: 查看差异后选择保留的内容

### Q: 自动同步会产生冲突吗？

**A**: 自动同步在检测到冲突时会暂停，让您手动解决。

### Q: 覆盖后能恢复吗？

**A**: 可以。所有覆盖操作前会自动备份，保留 7 天。

---

## 存储相关

### Q: 免费额度是多少？

**A**: 七牛云免费额度:

- 10GB 存储
- 10GB HTTP 流量/月

对于个人使用完全足够。

### Q: 会话数据有多大？

**A**: 典型会话大小:

- 小型会话 (50 条消息): ~10-50 KB
- 中型会话 (200 条消息): ~50-200 KB
- 大型会话 (1000 条消息): ~200-500 KB

压缩后更小。

### Q: 如何查看存储使用量？

**A**:

```bash
/list-sessions
# 会在列表末尾显示存储使用情况
```

### Q: 存储空间不足怎么办？

**A**:

```bash
# 清理旧会话
/cleanup-sessions

# 或升级七牛云套餐
```

### Q: 如何删除所有云端数据？

**A**:

1. 方法 1: 逐个删除会话

```bash
/list-sessions  # 获取所有会话 ID
/delete-session <id> --force
```

2. 方法 2: 在七牛云控制台直接删除空间

---

## 性能相关

### Q: 同步速度有多快？

**A**: 取决于多个因素:

- 网络速度
- 会话大小
- 距离服务器远近

典型情况:

- 小型会话: < 1 秒
- 中型会话: 1-3 秒
- 大型会话: 3-10 秒

### Q: 同步会影响性能吗？

**A**: 不会明显影响:

- 后台异步操作
- 不阻塞主线程
- 可随时中断 (Ctrl+C)

### Q: 大型会话能同步吗？

**A**: 可以，但可能需要较长时间。建议:

- 定期同步，避免积累过多数据
- 使用增量同步

---

## 离线相关

### Q: 离线时能使用吗？

**A**: 可以。离线时:

- 本地功能正常工作
- 可以继续对话
- 恢复联网后自动同步

### Q: 离线时修改会话会丢失吗？

**A**: 不会。本地修改会保留，联网后可同步到云端。

### Q: 如何检测网络状态？

**A**: 系统会自动检测网络状态，离线时显示警告。

---

## 故障排除

### Q: 同步失败怎么办？

**A**: 检查以下项:

1. 网络连接是否正常
2. 七牛云配置是否正确: `/configure-qiniu --status`
3. 存储空间是否充足
4. 密钥是否有效

### Q: 提示"认证失败"怎么办？

**A**:

1. 检查 AccessKey 和 SecretKey
2. 确认密钥未过期
3. 重新配置: `/configure-qiniu`

### Q: 提示"空间不存在"怎么办？

**A**:

1. 确认空间名称正确
2. 确认空间已创建
3. 检查区域代码是否匹配

### Q: 恢复会话失败怎么办？

**A**:

1. 确认会话 ID 正确
2. 检查加密密钥是否匹配
3. 如果使用密码，确认密码正确

### Q: 如何查看详细日志？

**A**: 日志位于 `~/.codebuddy/logs/`，可查看详细错误信息。

---

## 其他问题

### Q: 能分享会话给其他人吗？

**A**: 当前版本不支持会话分享功能。未来可能考虑此功能。

### Q: 能导出会话到本地文件吗？

**A**: 当前版本不支持直接导出，但会话数据已存储在本地。

### Q: 支持移动端吗？

**A**: 当前版本仅支持桌面端。移动端支持正在规划中。

### Q: 如何关闭自动同步？

**A**:

```bash
# 重新运行同步命令，不加 --auto 参数
/sync-session
```

### Q: 能使用其他云存储吗？

**A**: 当前仅支持七牛云。如需支持其他云存储，请提交 Feature Request。

---

## 获取帮助

如果以上 FAQ 无法解决您的问题:

1. 查看详细文档: [使用指南](./cloud-session-sync.md)
2. 查看日志文件: `~/.codebuddy/logs/`
3. 提交 Issue: [GitHub Issues](https://github.com/your-repo/issues)
4. 联系技术支持

---

## 更新日期

最后更新: 2024-01-30
